<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8">
  <title>Movimentação de Estoque</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <header>
    <h1>Movimentação de Estoque</h1>
  </header>

  <nav>
    <a href="index.html">Início</a>
    <a href="produtos.html">Cadastro</a>
    <a href="movimentacao.html">Movimentação</a>
    <a href="estoque.html">Estoque</a>
    <a href="historico.html">Histórico</a>
  </nav>

  <main class="container">
    <section class="card">
      <h2>Registrar Movimentação</h2>

      <form id="form-movimentacao" onsubmit="event.preventDefault(); registrarMovimentacao();">
        <!-- ✅ Senha movida para o topo -->
        <label for="senha-movimentacao">Senha:</label>
        <input type="password" id="senha-movimentacao" required>

        <!-- ✅ Campo agora aceita código OU nome -->
        <label for="codigo-movimentacao">Código ou Nome do Produto:</label>
        <input type="text" id="codigo-movimentacao" required placeholder="Digite o código ou nome do produto">

        <label for="tipo">Tipo:</label>
        <select id="tipo" required>
          <option value="Entrada">Entrada</option>
          <option value="Saída">Saída</option>
        </select>

        <label for="quantidade-movimentacao">Quantidade:</label>
        <input type="number" id="quantidade-movimentacao" required min="1">

        <label for="origem-destino">Origem/Destino:</label>
        <input type="text" id="origem-destino">

        <label for="observacoes">Observações:</label>
        <input type="text" id="observacoes">

        <div class="actions">
          <button type="button" class="btn" onclick="registrarMovimentacao()">Registrar</button>
        </div>
      </form>
    </section>
  </main>

  <footer>
    <p class="muted">Projeto extensionista • Controle de estoque</p>
  </footer>

  <script src="script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('codigo-movimentacao');
      if (!input) return;

      input.addEventListener('input', () => {
        const termo = normalizeText(input.value);
        if (!termo) return;

        const lista = Array.isArray(window.produtosCache) ? window.produtosCache : [];
        const encontrado = lista.find(p => {
          const codNorm = normalizeText(p['Código'] || "");
          const nomeNorm = normalizeText(p['Produto'] || "");
          return codNorm === termo || nomeNorm.includes(termo);
        });
      });
    });
  </script>

</body>

</html>